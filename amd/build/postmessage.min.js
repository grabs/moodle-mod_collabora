/**
 * Closes the collabora window.
 *
 * @module     mod_collabora/monitorclose
 * @author     Andreas Grabs <moodle@grabs-edv.de>
 * @copyright  2019 Humboldt-Universit√§t zu Berlin <moodle-support@cms.hu-berlin.de>
 * @license    http://www.gnu.org/copyleft/gpl.html GNU GPL v3 or later
 */
define("mod_collabora/postmessage",[],(function(){var collaboraUrl,courseURL,asPopup,iframe;function receiveMessage(event){var msg;if(console.log("ReceiveMessage: "+event.data),msg=JSON.parse(event.data))switch(msg.MessageId){case"UI_Close":asPopup?window.close():window.location.href=courseURL;break;case"App_LoadingStatus":!function(msg){if(msg.Values){if("Document_Loaded"==msg.Values.Status)console.log("Tell the wopi client that we are ready to receive messages"),function(postObject){var message=JSON.stringify(postObject);console.log("Post message to collabora: "+message),iframe.postMessage(message,collaboraUrl)}({MessageId:"Host_PostmessageReady",SendTime:Date.now()})}}(msg)}}return{init:function(opts){collaboraUrl=opts.collaboraurl,courseURL=opts.courseurl,asPopup=opts.aspopup,iframe=(iframe=document.getElementById(opts.iframeid)).contentWindow||iframe.contentDocument.document||iframe.contentDocument,window.addEventListener("message",receiveMessage)}}}));

//# sourceMappingURL=postmessage.min.js.map